<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Admin Dashboard</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Train+One&display=swap" rel="stylesheet">
  <!-- Box Icons -->   
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  
  <!-- Template Main CSS File -->
  <link href="/css/admin.css" rel="stylesheet">

  <!-- Sweet alert -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">
  
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<style>
    /* Change the background color and text color of the SweetAlert modal */
    .swal2-popup {
      background-color: #f8f9fa; /* Light background color */
      color: #343a40; /* Dark text color */
      border-radius: 10px;
    }
  
    /* Change the button color */
    .swal2-confirm {
      background-color: #28a745; /* Green button */
      color: white;
      border: none;
    }
  
    /* Change the button hover color */
    .swal2-confirm:hover {
      background-color: #218838; /* Darker green on hover */
    }
  
    /* Change the title text style */
    .swal2-title {
      font-family: 'Arial', sans-serif; /* Change font */
      font-size: 24px;
      color: #007bff; /* Change title color */
      text-align: center; /* Center the title */
    }
  
    /* Change the content text style */
    .swal2-html-container {
      font-size: 18px;
      color: #6c757d; /* Grey color for content text */
      text-align: center; /* Center the content */
    }
  
    /* Center the modal */
    .swal2-popup {
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
  
    /* Modify the modal's position if you want */
    .swal2-container {
      position: fixed;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%);
    }
  
    /* Customize the cancel button */
    .swal2-cancel {
      background-color: #dc3545; /* Red button */
      color: white;
    }
  
    /* Change cancel button hover */
    .swal2-cancel:hover {
      background-color: #c82333;
    }
  </style>
<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center" style="text-decoration: none;">
        <div style="margin-top: 1rem;">
          <p class="logo-container" style="font-size: 2rem;border: 1px solid;font-weight: 600;color:#113779;font-family: 'Train One', serif;font-style: normal;border-style: ridge;padding: 0.5rem;border-radius: 5px;">
            Puzl Mart
            </p>
                    </div>
      <div class="rubik-cube">
        <div class="face front">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
        <div class="face back">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
        <div class="face right">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
        <div class="face left">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
        <div class="face top">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
        <div class="face bottom">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
      </div>
      </a>
      <!-- <i class="bi bi-list toggle-sidebar-btn" id="toggle-sidebar" onclick="openSidebar()"></i> -->
      <i class='bx bx-list-ul toggle-sidebar-btn' id="toggle-sidebar" ></i>
    </div><!-- End Logo -->

    <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="/admin/searchUser">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bx bx-search"></i></button>
      </form>
    </div><!-- End Search Bar -->

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">

        <li class="nav-item d-block d-lg-none">
          <a class="nav-link nav-icon search-bar-toggle " href="#">
            <i class="bx bx-search"></i>
          </a>
        </li><!-- End Search Icon-->

        
        <li class="nav-item dropdown pe-3">

          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="">
            <i class='bx bx-user-circle' style="font-size: 2rem;"></i>
            <span class="d-none d-md-block ps-2">Admin</span>
          </a>
        </li>
        <li>
          <a class="dropdown-item d-flex align-items-center" href="/admin/logout">
            <i class="bi bi-box-arrow-right"></i>
            <span>Sign Out</span>
          </a>
        </li>
      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link " href="/admin">
          <i class="bi bi-grid"></i>
          <span>Dashboard</span>
        </a>
      </li><!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#inventory-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Inventory</span><i class='bx bx-chevron-down ms-auto'></i>
        </a>
        <ul id="inventory-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="/admin/category">
              <i class="bi bi-circle"></i><span>Categories</span>
            </a>
          </li>
          <li>
            <a href="/admin/brands">
              <i class="bi bi-circle"></i><span>Brands</span>
            </a>
          </li>
          <li>
            <a href="/admin/products">
              <i class="bi bi-circle"></i><span>Products</span>
            </a>
          </li>
          
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#orders-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Orders</span><i class='bx bx-chevron-down ms-auto'></i>
        </a>
        <ul id="orders-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="/admin/orders">
              <i class="bi bi-circle"></i><span>Orders List</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#users-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Users</span><i class='bx bx-chevron-down ms-auto'></i>
        </a>
        <ul id="users-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="/admin/users">
              <i class="bi bi-circle"></i><span>Users List</span>
            </a>
          </li>
          <li>
            <a href="/admin/referrals">
              <i class="bi bi-circle"></i><span>Referral</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#offersAndCoupons-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Offers and Coupons</span><i class='bx bx-chevron-down ms-auto'></i>
        </a>
        <ul id="offersAndCoupons-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="/admin/offer">
              <i class="bi bi-circle"></i><span>Offer</span>
            </a>
          </li>
          <li>
            <a href="/admin/coupons">
              <i class="bi bi-circle"></i><span>Coupon</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#stockAndSale-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Stock and Sales Report</span><i class='bx bx-chevron-down ms-auto'></i>
        </a>
        <ul id="stockAndSale-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="/admin/stock">
              <i class="bi bi-circle"></i><span>Stock</span>
            </a>
          </li>
          <li>
            <a href="/admin/salesReport">
              <i class="bi bi-circle"></i><span>Sales Report</span>
            </a>
          </li>
        </ul>
      </li>
    </ul>

  </aside>

<main id="main" class="main">

    <div class="pagetitle">
      <h1>Users</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/admin">Home</a></li>
          <li class="breadcrumb-item">Dashboard</li>
          <li class="breadcrumb-item active"><a href="/admin/users">Users</a></li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section">
      <div class="row">
        <div class="col-lg-12">

          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Users</h5>
              <% if(data.length > 0){ %>
              <table class="table datatable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone Number</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                <% for(let i=0 ; i<data.length ; i++){ %>
                  <tr>
                    <td><%= data[i].name %></td>
                    <td><%=data[i].email%></td>
                    <td><%= data[i].phone %></td>
                    <td>
                        <% if(data[i].isBlocked === false ){ %>
                            <button class="btn btn-danger" >
                                <a  class="text-white" style="text-decoration: none;" onclick = "return confirmBlockUser('<%=data[i]._id%>')">Block</a>
                            </button>
                        <% }else{ %>
                            <button class="btn btn-success" >
                                <a  class="text-white" style="text-decoration: none;" onclick = "return confirmunBlockUser('<%=data[i]._id%>')">Unblock</a>
                            </button>
                        <% } %>
                    </td>
                <% } %>
                </tbody>
              </table>
              <% }else{ %>
                <h3>No User is found</h3>
              <% } %>
            </div>
            <div class="container mt-3">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center mb-20" style="margin-right: 200px;">
                        <% for(let i=1 ; i<=totalPages ; i++){ %>
                            <li class="page-item <%=(i===currentPage)? 'active' : ''%>">
                                <a class="page-link" href="?page=<%=i%>"><%= i %></a>
                            </li>
                        <% } %>
                    </ul>
                </nav>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const toggleButton = document.querySelector(".toggle-sidebar-btn");
    const body = document.body;
  
    if (toggleButton) {
      toggleButton.addEventListener("click", function () {
        body.classList.toggle("toggle-sidebar");
      });
    }

    const toggleLinks = document.querySelectorAll(".nav-link[data-bs-toggle='collapse']");

    toggleLinks.forEach((link) => {
      link.addEventListener("click", function () {
        const chevronIcon = this.querySelector(".bx");


          if (this.classList.contains("show")) {
            setTimeout(() => {
            chevronIcon.classList.remove("bx-chevron-up");
            chevronIcon.classList.add("bx-chevron-down");
          }, 100); 
          } else {
            setTimeout(() => {
            chevronIcon.classList.remove("bx-chevron-down");
            chevronIcon.classList.add("bx-chevron-up");
          }, 100); 
          }
         
      });
    });
});

async function confirmBlockUser(userId){
                const confirmation = await Swal.fire({
                    title:'Are you sure?',
                    text:'Do you want to block the user?',
                    icon:'warning',
                    showCancelButton:true,
                    confirmButtonText:'Yes, Block the user!',
                    cancelButtonText:'Cancel',
                    reverseButtons:true
                });

                if(confirmation.isConfirmed){
                    fetch(`/admin/blockCustomer/${userId}`,{
                        method:'POST',
                        headers:{
                            'Content-Type':'application/json'
                        },
                        body:JSON.stringify({isBlocked:true})
                    })
                    .then(response => {
                        if(response.ok){
                            Swal.fire('Blocked','The user has been blocked successfully','success')
                            .then(() => location.reload());
                        }else{
                            Swal.fire('Error!','Failed to block the user. Please try again.', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error blocking user : ',error);
                        Swal.fire('Error!', 'An error occurred while trying to block the user. Please try again.', 'error');
                    });
                }
            }
async function confirmunBlockUser(userId){
                const confirmation = await Swal.fire({
                    title:'Are you sure?',
                    text:'Do you want to unblock the user?',
                    icon:'warning',
                    showCancelButton:true,
                    confirmButtonText:'Yes,Unblock the user!',
                    cancelButtonText:'Cancel',
                    reverseButtons:true
                });
                if(confirmation.isConfirmed){
                    fetch(`/admin/unblockCustomer/${userId}`,{
                        method:'POST',
                        headers:{
                            'Content-Type':'application/json'
                        },
                        body:JSON.stringify({isBlocked:false})
                    })
                    .then(response => {
                        if(response.ok){
                            Swal.fire('Unblocked','The user has been unblocked successfully','success')
                            .then(() => location.reload());
                        }else{
                            Swal.fire('Error!','Failed to delete the unblock the user. Please try again.','error');
                        }
                    })
                    .catch(error => {
                        console.error('Error unblocking user : ',error);
                        Swal.fire('Error!','An error occurred while trying to unblock the user','error')
                    });
                }
            }
</script>
</body>
</html>

<!-- <main class="col-md-10 ml-sm-auto px-4">
    <h3 class="my-4">Product List</h3>
            <div class="container mt-5">
                <table class="table table-hover table-bordered table-responsive" style="box-shadow: 1px 1px 8px black;">
                    <thead style="background-color: #04625f;color:white">
                      <tr>
                        <th scope="col"><b>Name</b></th>
                        <th scope="col"><b>Email</b></th>
                        <th scope="col"><b>Phone No</b></th>
                        <th scope="col"><b>Action</b></th>
                      </tr>
                    </thead>
                    <tbody style="background-color: #f0ffff;color:#04625f">
                        <% for(let i=0 ; i<data.length ; i++){ %>
                            <tr>
                                <td><%= data[i].name %></td>
                                <td><%= data[i].email %></td>
                                <td><%= data[i].phone %></td>
                                <td> 
                                    <% if(data[i].isBlocked === false ){ %>
                                        <button class="btn btn-danger" style="width: 80px;">
                                            <a  class="text-white" style="text-decoration: none;" onclick = "return confirmBlockUser('<%=data[i]._id%>')">Block</a>
                                        </button>
                                        <% }else{ %>
                                        <button class="btn btn-success" style="width: 80px;">
                                            <a  class="text-white" style="text-decoration: none;" onclick = "return confirmunBlockUser('<%=data[i]._id%>')">Unblock</a>
                                        </button>
                                        <% } %>
                                </td>
                            </tr>
                        <% } %>  
                    </tbody>
                  </table>
        </div>
        <div class="container mt-3">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center mb-20" style="margin-right: 200px;">
                    <% for(let i=1 ; i<=totalPages ; i++){ %>
                        <li class="page-item <%=(i===currentPage)? 'active' : ''%>">
                            <a class="page-link" href="?page=<%=i%>"><%= i %></a>
                        </li>
                    <% } %>
                </ul>
            </nav>
        </div>
</main>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            function confirmBlockUser(userId){
                const confirmation = Swal.fire({
                    title:'Are you sure?',
                    text:'Do you want to block the user?',
                    icon:'warning',
                    showCancelButton:true,
                    confirmButtonText:'Yes, Block the user!',
                    cancelButtonText:'Cancel',
                    reverseButtons:true
                });

                if(confirmation.isConfirmed){
                    fetch(`/admin/blockCustomer/${userId}`,{
                        method:'POST',
                        headers:{
                            'Content-Type':'application/json'
                        },
                        body:JSON.stringify({isBlocked:true})
                    })
                    .then(response => {
                        if(response.ok){
                            Swal.fire('Blocked','The user has been blocked successfully','success')
                            .then(() => location.reload());
                        }else{
                            Swal.fire('Error!','Failed to block the user. Please try again.', 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error blocking user : ',error);
                        Swal.fire('Error!', 'An error occurred while trying to block the user. Please try again.', 'error');
                    });
                }
            }

            function confirmunBlockUser(userId){
                if(confirm('Are you sure? Do you want to unblock the user?')){
                    fetch(`/admin/unblockCustomer/${userId}`,{
                        method:'POST',
                        headers:{
                            'Content-Type':'application/json'
                        },
                        body:JSON.stringify({isBlocked:false})
                    })
                    .then(response => {
                        if(response.ok){
                            alert('User unblocked successfully')
                            window.location.reload();
                        }else{
                            alert('Failed to unblock the user');
                        }
                    })
                    .catch(error => {
                        console.error('Error unblocking user : ',error);
                        alert('An error occurred while trying to unblock the user')
                    });
                }
            }
        </script>
<%- include("../../views/partials/admin/footer") %> -->
