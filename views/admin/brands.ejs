<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Admin Dashboard</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Train+One&display=swap" rel="stylesheet">
  <!-- Box Icons -->   
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  
  <!-- Template Main CSS File -->
  <link href="/css/admin.css" rel="stylesheet">

  <!-- Sweet alert -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">
  
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<style>
    /* Change the background color and text color of the SweetAlert modal */
    .swal2-popup {
      background-color: #f8f9fa; /* Light background color */
      color: #343a40; /* Dark text color */
      border-radius: 10px;
    }
  
    /* Change the button color */
    .swal2-confirm {
      background-color: #28a745; /* Green button */
      color: white;
      border: none;
    }
  
    /* Change the button hover color */
    .swal2-confirm:hover {
      background-color: #218838; /* Darker green on hover */
    }
  
    /* Change the title text style */
    .swal2-title {
      font-family: 'Arial', sans-serif; /* Change font */
      font-size: 24px;
      color: #007bff; /* Change title color */
      text-align: center; /* Center the title */
    }
  
    /* Change the content text style */
    .swal2-html-container {
      font-size: 18px;
      color: #6c757d; /* Grey color for content text */
      text-align: center; /* Center the content */
    }
  
    /* Center the modal */
    .swal2-popup {
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
  
    /* Modify the modal's position if you want */
    .swal2-container {
      position: fixed;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%);
    }
  
    /* Customize the cancel button */
    .swal2-cancel {
      background-color: #dc3545; /* Red button */
      color: white;
    }
  
    /* Change cancel button hover */
    .swal2-cancel:hover {
      background-color: #c82333;
    }
  </style>
<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center" style="text-decoration: none;">
        <div style="margin-top: 1rem;">
          <p class="logo-container" style="font-size: 2rem;border: 1px solid;font-weight: 600;color:#113779;font-family: 'Train One', serif;font-style: normal;border-style: ridge;padding: 0.5rem;border-radius: 5px;">
            Puzl Mart
            </p>
                    </div>
      <div class="rubik-cube">
        <div class="face front">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
        <div class="face back">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
        <div class="face right">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
        <div class="face left">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
        <div class="face top">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
        <div class="face bottom">
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
          <div></div><div></div><div></div>
        </div>
      </div>
      </a>
      <!-- <i class="bi bi-list toggle-sidebar-btn" id="toggle-sidebar" onclick="openSidebar()"></i> -->
      <i class='bx bx-list-ul toggle-sidebar-btn' id="toggle-sidebar" ></i>
    </div><!-- End Logo -->

    <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="/admin/searchBrand">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bx bx-search"></i></button>
      </form>
    </div><!-- End Search Bar -->

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">

        <li class="nav-item d-block d-lg-none">
          <a class="nav-link nav-icon search-bar-toggle " href="#">
            <i class="bx bx-search"></i>
          </a>
        </li><!-- End Search Icon-->

        
        <li class="nav-item dropdown pe-3">

          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="">
            <i class='bx bx-user-circle' style="font-size: 2rem;"></i>
            <span class="d-none d-md-block ps-2">Admin</span>
          </a>
        </li>
        <li>
          <a class="dropdown-item d-flex align-items-center" href="/admin/logout">
            <i class="bi bi-box-arrow-right"></i>
            <span>Sign Out</span>
          </a>
        </li>
      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link " href="/admin">
          <i class="bi bi-grid"></i>
          <span>Dashboard</span>
        </a>
      </li><!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#inventory-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Inventory</span><i class='bx bx-chevron-down ms-auto'></i>
        </a>
        <ul id="inventory-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="/admin/category">
              <i class="bi bi-circle"></i><span>Categories</span>
            </a>
          </li>
          <li>
            <a href="/admin/brands">
              <i class="bi bi-circle"></i><span>Brands</span>
            </a>
          </li>
          <li>
            <a href="/admin/products">
              <i class="bi bi-circle"></i><span>Products</span>
            </a>
          </li>
          
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#orders-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Orders</span><i class='bx bx-chevron-down ms-auto'></i>
        </a>
        <ul id="orders-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="/admin/orders">
              <i class="bi bi-circle"></i><span>Orders List</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#users-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Users</span><i class='bx bx-chevron-down ms-auto'></i>
        </a>
        <ul id="users-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="/admin/users">
              <i class="bi bi-circle"></i><span>Users List</span>
            </a>
          </li>
          <li>
            <a href="/admin/referrals">
              <i class="bi bi-circle"></i><span>Referral</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#offersAndCoupons-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Offers and Coupons</span><i class='bx bx-chevron-down ms-auto'></i>
        </a>
        <ul id="offersAndCoupons-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="/admin/offer">
              <i class="bi bi-circle"></i><span>Offer</span>
            </a>
          </li>
          <li>
            <a href="/admin/coupons">
              <i class="bi bi-circle"></i><span>Coupon</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#stockAndSale-nav" data-bs-toggle="collapse" href="#">
          <i class="bi bi-menu-button-wide"></i><span>Stock and Sales Report</span><i class='bx bx-chevron-down ms-auto'></i>
        </a>
        <ul id="stockAndSale-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="/admin/stock">
              <i class="bi bi-circle"></i><span>Stock</span>
            </a>
          </li>
          <li>
            <a href="/admin/salesReport">
              <i class="bi bi-circle"></i><span>Sales Report</span>
            </a>
          </li>
        </ul>
      </li>
    </ul>

  </aside>

<main id="main" class="main">
  <div class="pagetitle">
    <h1>Brands</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/admin">Home</a></li>
        <li class="breadcrumb-item">Dashboard</li>
        <li class="breadcrumb-item active"><a href="/admin/brands">Brands</a></li>
      </ol>
    </nav>
  </div> <!-- End Page Title -->

  <section class="section">
    <div class="row">
      <div class="col-lg-12">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Brands</h5>
            <div>
              <a href="#brandForm" class="btn btn-primary" style="text-decoration: none;" id="addBrand">Add New Brand</a>
            </div>
            <% if(data.length > 0){ %>
            <table class="table datatable">
              <thead>
                <tr>
                  <th>Logo</th>
                  <th>Brand</th>
                  <th>Status</th>
                  <th>Block/Unblock</th>
                  <th>Remove</th>
                </tr>
              </thead>
              <tbody>
              <% data.reverse().forEach((brand,index) =>{ %>
                <tr>
                  <td style="width: 10%;"><img src="/uploads/re-image/<%=brand.brandImage%>" alt="<%=brand.brandName%>" style="width:100%;border-radius: 5px;box-shadow: 0px 1px 8px #00000096;"></td>
                  <td><%=brand.brandName%></td>
                  <td>
                      <% if(brand.isBlocked){ %>
                          <span class="badge rounded-pill alert-danger">Blocked</span>
                      <% }else{ %>
                          <span class="badge rounded-pill alert-success">Unblocked</span>
                      <% } %>
                  </td>
                  <td>
                      <% if(brand.isBlocked===false){ %>
                          <button class="btn btn-danger" onclick="confirmBlock('<%=brand._id%>')">
                            Block
                          </button>
                      <% }else{ %>
                          <button class="btn btn-success" onclick="confirmUnblock('<%=brand._id%>')">
                            Unblock
                          </button>
                      <% } %>
                  </td>
                  <td><button class="btn btn-danger" onclick="return confirmDelete('<%=brand._id%>')">Delete</button></td>
                </tr>
              <% }) %>
              </tbody>
            </table>
            <% }else{ %>
              <h3>No brand is added</h3>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div class="card" id="brandForm" style="display: none;">
    <div class="card-body">
      <h5 class="card-title">Add New Category Brand</h5>
  
      <form class="row g-3" onsubmit="handleFormSubmit(event)" enctype="multipart/form-data">
        <div class="col-md-12">
          <div class="form-floating">
            <img id="previewImage" src="" alt="" />
            <div class="col-sm-10">
              <label for="">Choose Brand Image</label>
            </div>
            <div class="col-sm-10">
              <input class="form-control" type="file" name="image" id="brandImage" placeholder="Brand Image">
            </div>
            <div id="image-error" class="error-message"></div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-floating">
            <input type="text" class="form-control" id="name" placeholder="Brand Name" name="name">
            <label for="floatingName">Brand Name</label>
            <div id="name-error" class="error-message"></div>
          </div>
        </div>
        <div class="text-center">
          <button type="submit" class="btn btn-primary">Add Brand</button>
        </div>
      </form>
  
    </div>
  </div>
</main>

<footer id="footer" class="footer">
  <div class="copyright">
    &copy; Copyright <strong><span>Puzl Mart</span></strong>. All Rights Reserved
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>
<script>
  const addBrand = document.getElementById('addBrand');
  const brandForm = document.getElementById('brandForm');
  addBrand.addEventListener('click',() => {
    brandForm.style.display = 'block'
  })
  function confirmBlock(brandId) {
    Swal.fire({
      title: 'Are you sure?',
      text: 'Do you want to block this brand?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Yes, Block it!',
      cancelButtonText: 'Cancel',
      reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = `/admin/blockBrand?id=${brandId}`;
      }
    });
  }

  function confirmUnblock(brandId) {
    Swal.fire({
      title: 'Are you sure?',
      text: 'Do you want to unblock this brand?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Yes, Unblock it!',
      cancelButtonText: 'Cancel',
      reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = `/admin/unblockBrand?id=${brandId}`;
      }
    });
  }

  function confirmDelete(brandId) {
    const confirmation = Swal.fire({
      title: 'Are you sure?',
      text: 'Do you want to delete the brand?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Yes, Delete it!',
      cancelButtonText: 'Cancel',
      reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        fetch(`/admin/deleteBrand?id=${brandId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
          }
        })
        .then(response => {
          if (response.ok) {
            Swal.fire('Deleted', 'The brand has been deleted successfully', 'success')
            .then(() => location.reload());
          } else {
            Swal.fire('Error!', 'Failed to delete the brand. Please try again', 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          Swal.fire('Error!', 'An error occurred while trying to delete the brand', 'error');
        });
      }
    });
  }
  document.getElementById('brandImage').addEventListener('change', function(event) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const previewImage = document.getElementById('previewImage');
      previewImage.src = e.target.result;
      previewImage.style.width = '15%';
      previewImage.style.borderRadius = '10px';
      previewImage.style.margin = '1rem';
      previewImage.style.boxShadow = '0px 2px 15px 0px #00000096';
    };
    reader.readAsDataURL(event.target.files[0]);
  });
  function handleFormSubmit(event){
    event.preventDefault();
    if(!validateForm()){
      return;
    }
    const form = event.target;

    const formData = new FormData(form);

    fetch('/admin/addBrand', {
      method: 'POST',
      body: formData,
    })
    .then(response => {
      if(!response.ok){
        throw new Error(`HTTP error : ${response.status}`);
      }
      return response.json()
    })
    .then(data => {
      Swal.fire({
        icon: data.type,
        title: data.message,
        showConfirmButton:true,
        timer:1500
      }).then(()=>{
         if(data.type === 'success'){
          window.location.href='/admin/brands';
        }
      });
    })
    .catch(error => {
      console.error('Error : ',error);
        Swal.fire({
          icon:'error',
          title:'Something went wrong!',
          showConfirmButton:true,
          timer:1500
        });
    });
  }

  function validateForm(){
    clearErrorMessages();
    const name = document.getElementsByName('name')[0].value.trim();
    const image = document.getElementById('brandImage')
    let isValid = true;

    if(name === ''){
    displayErrorMessage('name-error','Please enter a name');
    isValid = false;
  }else if(!/^[a-zA-Z0-9\s]+$/.test(name)){
    displayErrorMessage('name-error','Brand name should contain only alphanumeric characters');
    isValid = false;
  }
  
  if(image.files.length===0){
    displayErrorMessage('image-error','Please add an image');
    isValid = false
  }
  return isValid;

  }

  function displayErrorMessage(elementId,message){

    var errorElement = document.getElementById(elementId);
    errorElement.innerText = message;
    errorElement.style.display = 'block';
    errorElement.style.color = 'red';

  }

  function clearErrorMessages(){
    const errorElements = document.getElementsByClassName('error-message');

    Array.from(errorElements).forEach((element) => {
      element.innerText = '';
      element.style.display = 'none';
    })
  }
</script>
</body>
</html>


<!-- <section class="content-main">
  <div class="content-header">
    <div>
      <h2 class="content-title card-title">Brands</h2>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="col-md-3">
          <form method="post" action="/admin/addBrand" enctype="multipart/form-data">
            <div class="mb-4">
              <label for="product_name" class="form-label" >Brand Name</label>
              <input type="text" name="name" placeholder="Type here" class="form-control mt-1"
              />
            </div>
            <label for="product_name" class="form-label" >Brand Image</label>
            <div class="input-upload" >
              <img src="" alt=""/>
              <input class="form-control border" style="margin-top:-1.5rem" name="image" type="file" />
            </div>
            <div class="d-grid my-4">
              <button class="btn mt-20 text-white" style="background-color: #04625f;" type="submit">
                Add Brand
              </button>
            </div>
          </form>
        </div>
        <div class="col-md-7 ml-105">
          <div class="table-responsive" style="box-shadow: 1px 1px 8px black;">
            <table class="table table-hover table-bordered" style="margin-bottom: 0rem;">
              <thead style="background-color: #04625f;color:white">
                <tr>
                  <th scope="col">Brand</th>
                  <th scope="col">Logo</th>
                  <th scope="col">Status</th>
                  <th scope="col">Block/Unblock/Delete</th>
                </tr>
              </thead>
              <tbody style="background-color: #f0ffff;color:#04625f">
                <% data.reverse().forEach((brand,index) =>{ %>
                <tr>
                  <td class="text-start"><%=brand.brandName%></td>
                  <td class="text-start">
                    <div class="d-flex align-items-center justify-content-center" style="width: 120px; height: 120px; border-radius: 50%; overflow: hidden;">
                      <img src="/uploads/re-image/<%=brand.brandImage%>" alt="<%=brand.brandName%>" class="img-fluid rounded-circle" style="width: 100%; height: auto" />
                    </div>
                  </td>
                  <td class="text-start">
                    <% if(brand.isBlocked){ %>
                    <span class="badge rounded-pill alert-danger" style="width: 60px" >Blocked</span>
                    <% }else{ %>
                    <span class="badge rounded-pill alert-success" style="width: 60px" >Active</span>
                    <% } %>
                  </td>
                  <td class="text-start">
                    <% if(brand.isBlocked===false){ %>
                    <button class="btn btn-danger" style="width: 90px">
                      <a href="/admin/blockBrand?id=<%-brand._id%>" class="text-white" style="text-decoration: none;">Block</a>
                    </button>
                    <% }else{ %>
                    <button class="btn btn-success" style="width: 90px">
                      <a href="/admin/unBlockBrand?id=<%=brand._id%>" class="text-white" style="text-decoration: none;">Unblock</a>
                    </button>
                    <% } %>
                    <button class="btn btn-danger" style="width: 90px" onclick="return confirmDelete('<%=brand._id%>')">Delete</button>
                  </td>
                </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="pagination-container">
</div>
</section>
<script>
    function confirmDelete(brandId) {
      if (confirm('Are you sure you want to delete this brand?')) {
        fetch(`/admin/deleteBrand?id=${brandId}`, {
          method: 'DELETE'
        })
        .then(response => {
          if (response.ok) {
            window.location.reload(); 
          } else {
            alert('Failed to delete brand');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred while trying to delete the brand');
        });
      }
    }
  </script>
  
<%- include("../../views/partials/admin/footer") %> -->
